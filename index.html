<!DOCTYPE html>

<html :class="{ dark: isDark }" lang="fr" x-data="galleryApp()" x-init="init()">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>‚ú® Galerie Meifox ‚ú®</title>
  <link href="style.css" rel="stylesheet" />
  <script defer="" src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>


<body>
  <header class="page-header">
    <h1>‚ú® Galerie Meifox ‚ú®</h1>
    <button @click="toggleTheme" class="theme-toggle-fixed">
      <span x-text="isDark ? '‚òÄÔ∏è Mode clair' : 'üåô Mode sombre'"></span>
    </button>
  </header>
  <div class="content-wrapper">
    <!-- MENU -->
    <aside class="sidebar">
      <nav class="menu"><button :class="{ 'active': selectedCategory === 'all' }" @click="setCategory('all')">All
          üñºÔ∏è</button><button :class="{ 'active': selectedCategory === 'caleb' }" @click="setCategory('caleb')"
          x-html="emojiMap['caleb'] + ' ' + capitalize('caleb')"></button><button
          :class="{ 'active': selectedCategory === 'mc' }" @click="setCategory('mc')"
          x-html="emojiMap['mc'] + ' ' + capitalize('mc')"></button><button
          :class="{ 'active': selectedCategory === 'rafayel' }" @click="setCategory('rafayel')"
          x-html="emojiMap['rafayel'] + ' ' + capitalize('rafayel')"></button><button
          :class="{ 'active': selectedCategory === 'sylus' }" @click="setCategory('sylus')"
          x-html="emojiMap['sylus'] + ' ' + capitalize('sylus')"></button><button
          :class="{ 'active': selectedCategory === 'xavier' }" @click="setCategory('xavier')"
          x-html="emojiMap['xavier'] + ' ' + capitalize('xavier')"></button><button
          :class="{ 'active': selectedCategory === 'zayne' }" @click="setCategory('zayne')"
          x-html="emojiMap['zayne'] + ' ' + capitalize('zayne')"></button></nav>
      </aside>
    <!-- GALERIE -->
    <main class="gallery">
      <template :key="img.src" x-for="img in filteredImages">
        <div class="image-wrapper">
          <img :alt="`${img.category} - galerie`" :src="img.src" @click="openLightbox(img.src)" />
        </div>
      </template>
    </main>
  </div>
  <!-- LIGHTBOX -->
  <div @click.self="closeLightbox" class="lightbox" x-show="lightboxOpen">
    <img :src="lightboxImage" alt="Zoom">
    <button @click="closeLightbox" class="close-btn">‚úñ</button>
    </img>
  </div>
  <!-- BOUTTON TO TOP -->
<button id="toTopBtn" title="Retour en haut">üîù</button>
</body>
</html>
  <!-- SCRIPT -->
  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('galleryApp', () => ({
        images: {},
        selectedCategory: 'all',
        allImages: [],
        lightboxOpen: false,
        lightboxImage: '',
        isDark: true,

        emojiMap: {
          caleb: 'üçé',
          rafayel: 'üêü',
          sylus: 'üê¶‚Äç‚¨õ',
          xavier: '‚ú®',
          zayne: 'üçê',
          mc: 'üíÑ'
        },

        capitalize(str) {
          return str.charAt(0).toUpperCase() + str.slice(1);
        },

        async init() {
          const saved = localStorage.getItem('theme');
          this.isDark = saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches);
          try {
            const res = await fetch('./images.json');
            const json = await res.json();
            this.images = json;
            this.allImages = Object.entries(this.images).flatMap(([category, files]) =>
              files.map(filename => ({
                src: `images/${category}/${filename}`,
                category
              }))
            );
          } catch (err) {
            console.error("Erreur chargement images.json", err);
          }
        },

        toggleTheme() {
          this.isDark = !this.isDark;
          localStorage.setItem('theme', this.isDark ? 'dark' : 'light');
        },

        setCategory(cat) {
          this.selectedCategory = cat;
        },

        get filteredImages() {
          if (this.selectedCategory === 'all') return this.allImages;
          return this.allImages.filter(img => img.category === this.selectedCategory);
        },

        openLightbox(src) {
          this.lightboxImage = src;
          this.lightboxOpen = true;
        },

        closeLightbox() {
          this.lightboxOpen = false;
          this.lightboxImage = '';
        }
      }));
    });

  const toTopBtn = document.getElementById("toTopBtn");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 300) {
      toTopBtn.classList.add("show");
    } else {
      toTopBtn.classList.remove("show");
    }
  });

  toTopBtn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
</script>

</body>

</html>